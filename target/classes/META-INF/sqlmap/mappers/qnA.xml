<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="QnA">
	<insert id="qnAWrite" parameterType="QnA">
		<if test="userId != null and userId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval,#{qnATitle},#{qnAContent},0, 0, QnANumber.currval, 0, 0, 0, 0, sysdate, #{userId},null,null)
		</if>
		<if test="companyId != null and companyId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval,#{qnATitle},#{qnAContent},0, 1, QnANumber.currval, 0, 0, 0, 0, sysdate,null, #{companyId},null)
		</if>
		<if test="adminId != null and adminId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval,#{qnATitle},#{qnAContent},0, 2, QnANumber.currval, 0, 0, 0, 0, sysdate, null, null, #{adminId})
		</if>
	</insert>
	
	<insert id="qnAModify" parameterType="QnA">
		<if test="userId != null and userId != ''">
		INSERT INTO QnA VALUES (#{qnANumber}, #{qnATitle}, #{qnAContent}, 0, 0, #{qnANumber}, #{qnARef}, #{qnAIndent}, 0, #{qnAReplyExist}, sysdate, #{userId},null,null)
		</if>
		<if test="companyId != null and companyId != ''">
		INSERT INTO QnA VALUES (#{qnANumber}, #{qnATitle}, #{qnAContent}, 0, 1, #{qnANumber}, #{qnARef}, #{qnAIndent}, 0, #{qnAReplyExist}, sysdate,null, #{companyId},null)
		</if>
		<if test="adminId != null and adminId != ''">
		INSERT INTO QnA VALUES (#{qnANumber}, #{qnATitle}, #{qnAContent}, 0, 2, #{qnANumber}, #{qnARef}, #{qnAIndent}, 0, #{qnAReplyExist}, sysdate, null, null, #{adminId})
		</if>
	</insert>	
	
	<insert id="qnAReplyWrite" parameterType="QnA">
		<if test="userId != null and userId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval, #{qnATitle},#{qnAContent},0, 0, #{qnAGroup},#{qnARef}+1,#{qnAIndent}+1, 0, 0,sysdate,#{userId},null,null)
		</if>
		<if test="companyId != null and companyId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval, #{qnATitle},#{qnAContent},0, 1, #{qnAGroup},#{qnARef}+1,#{qnAIndent}+1, 0, 0,sysdate,null,#{companyId},null)
		</if>
		<if test="adminId != null and adminId != ''">
		INSERT INTO QnA VALUES (QnANumber.nextval, #{qnATitle},#{qnAContent},0, 2, #{qnAGroup},#{qnARef}+1,#{qnAIndent}+1, 0, 0,sysdate,null,null,#{adminId})
		</if>
	</insert>
	<select id="qnADetail" parameterType="QnA" resultType="QnA">		
		
   SELECT Q.*,((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITER, ((SELECT USERPROFILEIMAGE FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYPROFILEIMAGE FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINPROFILEIMAGE FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
    WRITERPROFILEIMAGE FROM QNA Q WHERE QnANumber=#{qnANumber}		
	</select>
	
	<select id="qnAList" parameterType="QnA" resultType="QnA">
	SELECT * FROM (SELECT ROWNUM RN, A.* FROM (SELECT Q.*,((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   	(SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITER, ((SELECT USERPROFILEIMAGE FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYPROFILEIMAGE FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINPROFILEIMAGE FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITERPROFILEIMAGE FROM QNA Q WHERE ((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER)) LIKE '%'||#{writer}||'%' ORDER BY Q.QNAGROUP DESC, Q.QNAREF) A)
    WHERE RN BETWEEN #{startRow} AND #{endRow}
	</select>
	
	<select id="totCntSearchQnA" parameterType="QnA" resultType="int">
	SELECT COUNT(*) FROM (SELECT ROWNUM RN, A.* FROM (SELECT Q.*,((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITER, ((SELECT USERPROFILEIMAGE FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYPROFILEIMAGE FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINPROFILEIMAGE FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WriterProfile FROM QNA Q WHERE ((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER)) LIKE '%'||#{writer}||'%' ORDER BY Q.QNAGROUP DESC, Q.QNAREF) A)
	</select>
	
	<update id="qnAHitUp" parameterType="int">
		UPDATE QnA SET QnAHit=QnAHit+1 WHERE QnANumber=#{qnANumber}
	</update>
	
	<select id="qnAAdminList" resultType="QnA">
   SELECT Q.*,((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINNAME FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITER, ((SELECT USERPROFILEIMAGE FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYPROFILEIMAGE FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER) ||
   (SELECT ADMINPROFILEIMAGE FROM ADMIN A,QNA QA WHERE A.ADMINID=QA.ADMINID AND Q.QNANUMBER=QA.QNANUMBER))
   WRITERPROFILEIMAGE FROM QNA Q WHERE (QNAORIGINALWRITER=0 OR QNAORIGINALWRITER=1) AND QNAREPLYEXIST = 0 ORDER BY QNADATE DESC	
	</select>
	
	<select id="totQnA" resultType="int">
	SELECT COUNT(*) FROM QNA	
	</select>	
	
	<update id="qnAReplyExistUp" parameterType="int">
		UPDATE QNA SET QNAREPLYEXIST = 1 WHERE QNANUMBER = #{qnANumber}
	</update>
	
	<select id="getAnswerQnanumber" parameterType="QnA" resultType="int">
		SELECT QNANUMBER FROM QNA WHERE QNAREF = #{qnARef}+1 AND QNAGROUP = #{qnAGroup}
	</select>	
	
	<select id="myQnaList" parameterType="QnA" resultType="QnA">
   SELECT Q.*,((SELECT USERNAME FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYNAME FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER)) WRITER, 
   ((SELECT USERPROFILEIMAGE FROM USERS U,QNA QU WHERE U.USERID=QU.USERID AND Q.QNANUMBER=QU.QNANUMBER) || 
   (SELECT COMPANYPROFILEIMAGE FROM COMPANY C,QNA QC WHERE C.COMPANYID=QC.COMPANYID AND Q.QNANUMBER=QC.QNANUMBER)) WRITERPROFILEIMAGE 
   FROM QNA Q WHERE USERID = #{userId} or COMPANYID = #{companyId} ORDER BY QNADATE 	
	</select>
	
</mapper>